{% extends 'base.html.twig' %}

{% block title %}Sortie index
{% endblock %}

{% block body %}

	{% for message in app.flashes('notice') %}
		<div class="flash-notice">
			{{ message }}
		</div>
	{% endfor %}

	<div class="blocParticipant">
		<p>
			<strong>Date du jour :</strong>
			{{ date }}</p>
		<p>
			<strong>Participant :</strong>
			{{ user.name | capitalize }}
            {{ user.lastname | capitalize }}
        </p>
	</div>

	<div style="border: 1px solid #000; width: 95vw;padding: 20px;margin: 20px auto; display: flex; justify-content: center">
		<h1>Filtres</h1>
	</div>

	<div class="pure-g">
		<div class="pure-u-1">
			<table class="pure-table" style="margin: auto;">

				<thead>
					<tr>
						<th>Nom</th>
						<th>Date de la sortie</th>
						<th>Clôture</th>
						<th>inscrits/place</th>
						<th>Etat</th>
						<th>Inscrit</th>
						<th>Organisateur</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for sortie in sorties %}
						<tr>
						{% if user.id == sortie.organisateur.id or etats[sortie.etat.id-1].id != 1 %}
							<td>{{ sortie.nom }}</td>
							<td>{{ sortie.dateHeureDebut ? sortie.dateHeureDebut|date('d/m/Y H:i') : '' }}</td>
							<td>{{ sortie.dateLimiteInscription ? sortie.dateLimiteInscription|date('d/m/Y') : '' }}</td>
							<td>
								{% if nbInscrits[sortie.id] is defined %}
									{{ nbInscrits[sortie.id] }}
								{% else %}
									0
								{% endif %}
								/{{ sortie.nbInscriptionsMax }}</td>
							<td>{{ etats[sortie.etat.id-1].libelle }}</td>
							<td>
								{% if sortie.id in outingRegistered %}X
								{% endif %}
							</td>
							<td>{{ sortie.organisateur.prenom }}</td>
							<td style="display: flex; justify-content: center;">
								{% if etats[sortie.etat.id-1].id == 1 %}
									{# {% if user.id == sortie.organisateur.id %} #}
							<a href="{{ path('app_sortie_edit', {'id': sortie.id}) }}" class="pure-button pure-button-primary" style="margin-right: 10px;">Modifier</a>
							<a href="#" class="pure-button pure-button-primary" style="margin-right: 10px;">Publier</a>
									{# {% endif %} #}
								{% else %}
							<a href="{{ path('app_sortie_show', {'id': sortie.id}) }}" class="pure-button pure-button-primary" style="margin-right: 10px;">Afficher</a>
									{% if user.id == sortie.organisateur.id %}
										{% if etats[sortie.etat.id-1].id in [2,3] %}
							<a href="#" class="pure-button pure-button-primary" style="margin-right: 10px;">Annuler</a>
										{% endif %}
									{% else %}
										{% if sortie.id in outingRegistered %}
											{% if etats[sortie.etat.id-1].id in [2,3] %}
							{{ include('sortie/_desist_form.html.twig') }}
											{% endif %}
										{% else %}
											{% if etats[sortie.etat.id-1].id == 2 %}
							<a href="#" class="pure-button pure-button-primary" style="margin-right: 10px;">S'inscrire</a>
											{% endif %}
										{% endif %}
									{% endif %}
								{% endif %}
							</td>
						</tr>
						{% endif %}
					{% else %}
						<tr>
							<td colspan="8">no records found</td>
						</tr>
					{% endfor %}
				</tbody>
            
			</table>
        
		</div>
        <div class="pure-u-1" style="display:flex; justify-content: center;">
    <a href="{{ path('app_sortie_new') }}" class="pure-button pure-button-primary" style="margin-top: 10px; margin-bottom: 20px;">Créer une sortie</a>
        </div>
	</div>

	
{% endblock %}
